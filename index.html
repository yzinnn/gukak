<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>리듬 게임</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .instrument {
            display: inline-block;
            margin: 10px;
            position: relative;
        }
        .instrument img {
            width: 100px;
            height: 100px;
            cursor: pointer;
        }
        .note {
            position: absolute;
            width: 50px;
            height: 50px;
        }
        #inputForm {
            margin-bottom: 10px;
            padding-top: 10px;
        }
        #gameCanvas {
            border: 1px solid #000;
            display: block;
            margin: 0 auto;
            position: relative;
        }
        #instrumentContainer {
            display: flex;
            justify-content: center;
            position: relative;
        }
        .instrument {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .hit-line {
            position: absolute;
            width: 100%;
            height: 10px;
            background-color: black;
            bottom: 50px;
        }
    </style>
</head>
<body>
    <h1>리듬 게임</h1>
    <div id="inputForm">
        <label for="rythmInput">육보 입력:</label>
        <input type="text" id="rythmInput" placeholder="예: 갠 지 덩 쿵 덕">
        <button onclick="startGame()">시작</button>
    </div>
    <div id="instrumentContainer">
        <div class="instrument" id="kkwaenggari">
            <img src="Kkwaenggwari.jpg" alt="꽹가리">
            <p>꽹가리</p>
        </div>
        <div class="instrument" id="jing">
            <img src="jing.jpeg" alt="징">
            <p>징</p>
        </div>
        <div class="instrument" id="buk">
            <img src="buk.png" alt="북">
            <p>북</p>
        </div>
        <div class="instrument" id="janggu">
            <img src="janggu.jpg" alt="장구">
            <p>장구</p>
        </div>
    </div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <p id="score">점수: 0</p>
    <audio id="audio_kkwaenggwari_gan" src="https://yzinnn.github.io/gukak/audio/Kkwaenggwari_gang_1.mp3" preload="auto"></audio>
    <audio id="audio_kkwaenggwari_ji" src="https://yzinnn.github.io/gukak/audio/Kkwaenggwari_ji_1.mp3" preload="auto"></audio>
    <audio id="audio_jing_jing" src="https://yzinnn.github.io/gukak/audio/Jing_1.mp3" preload="auto"></audio>
    <audio id="audio_buk_dung" src="https://yzinnn.github.io/gukak/audio/buk_dung.mp3" preload="auto"></audio>
    <audio id="audio_buk_du" src="https://yzinnn.github.io/gukak/audio/buk_du.mp3" preload="auto"></audio>
    <audio id="audio_janggu_dung" src="https://yzinnn.github.io/gukak/audio/Janggu_dung_1.mp3" preload="auto"></audio>
    <audio id="audio_janggu_giduk" src="https://yzinnn.github.io/gukak/audio/Janggu_giduk_1.mp3" preload="auto"></audio>
    <audio id="audio_janggu_kung" src="https://yzinnn.github.io/gukak/audio/Janggu_kung_1.mp3" preload="auto"></audio>
    <audio id="audio_janggu_durururu" src="https://yzinnn.github.io/gukak/audio/Janggu_durururu_1.mp3" preload="auto"></audio>
    <audio id="audio_janggu_duk" src="https://yzinnn.github.io/gukak/audio/Janggu_duk_1.mp3" preload="auto"></audio>
    <script>
        const instrumentSounds = {
            kkwaenggari: {
                '갠': document.getElementById('audio_kkwaenggwari_gan'),
                '지': document.getElementById('audio_kkwaenggwari_ji')
            },
            jing: {
                '징': document.getElementById('audio_jing_jing')
            },
            buk: {
                '둥': document.getElementById('audio_buk_dung'),
                '두': document.getElementById('audio_buk_du')
            },
            janggu: {
                '덩': document.getElementById('audio_janggu_dung'),
                '기덕': document.getElementById('audio_janggu_giduk'),
                '쿵': document.getElementById('audio_janggu_kung'),
                '더러러러': document.getElementById('audio_janggu_durururu'),
                '덕': document.getElementById('audio_janggu_duk')
            }
        };

        const instrumentElements = document.querySelectorAll('.instrument img');
        const instrumentIds = ['kkwaenggari', 'jing', 'buk', 'janggu'];

        let score = 0;
        let notes = [];
        let userInput = '';
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameInterval;

        function startGame() {
            userInput = document.getElementById('rythmInput').value.split(' ');
            notes = userInput.map((note, index) => {
                const instrument = noteToInstrument(note);
                const x = instrumentIds.indexOf(instrument) * 200 + 50;
                return { x: x, y: 0, id: instrument, text: note };
            });
            score = 0;
            document.getElementById('score').textContent = '점수: ' + score;
            if (gameInterval) {
                clearInterval(gameInterval);
            }
            gameInterval = setInterval(gameLoop, 20);
        }

        function createNote(instrument, x) {
            notes.push({ x: x, y: 0, id: instrument, text: '' });
        }

        function noteToInstrument(note) {
            if (['갠', '지'].includes(note)) return 'kkwaenggari';
            if (note === '징') return 'jing';
            if (['둥', '두'].includes(note)) return 'buk';
            if (['덩', '기덕', '쿵', '더러러러', '덕'].includes(note)) return 'janggu';
            return 'kkwaenggari';
        }

        function playInstrument(instrument) {
            const soundKeys = Object.keys(instrumentSounds[instrument]);
            const randomKey = soundKeys[Math.floor(Math.random() * soundKeys.length)];
            const audioElement = instrumentSounds[instrument][randomKey];
            audioElement.currentTime = 0; // 오디오 재생을 처음부터 시작하도록 설정
            audioElement.play().catch(error => {
                console.error("소리 재생 중 오류 발생: ", error);
            });
            score += 10;
            document.getElementById('score').textContent = '점수: ' + score;
        }

        function drawNotes() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 350, canvas.width, 10);  // 타점 선을 굵게 설정
            notes.forEach(note => {
                note.y += 2;
                ctx.fillStyle = noteColor(note.id);
                ctx.fillRect(note.x, note.y, 50, 50);
                ctx.fillStyle = 'white';
                ctx.fillText(note.text, note.x + 5, note.y + 30);
            });
        }

        function noteColor(instrumentId) {
            switch (instrumentId) {
                case 'kkwaenggari': return 'purple';
                case 'jing': return 'orange';
                case 'buk': return 'skyblue';
                case 'janggu': return 'pink';
                default: return 'red';
            }
        }

        function gameLoop() {
            drawNotes();
            if (notes.length === 0) {
                clearInterval(gameInterval);
                alert('게임 종료! 최종 점수: ' + score);
            }
        }

        // 클릭 이벤트 리스너에 새로운 기능을 추가하겠습니다.
        instrumentElements.forEach(inst => {
            inst.addEventListener('click', () => {
                const id = inst.parentElement.id;
                const x = instrumentIds.indexOf(id) * 200 + 50;
                playInstrument(id); // 악기 소리 재생
                createNote(id, x); // 새로운 노트 생성
            });
        });
    </script>
</body>
</html>
